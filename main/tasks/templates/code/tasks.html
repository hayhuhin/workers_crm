{% extends 'code/base.html' %} {% block content %}  {% load widget_tweaks %}{% load static %}


<script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js' integrity='sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==' crossorigin='anonymous' referrerpolicy='no-referrer'></script> 
<script src="{% static 'script.js'%}"></script>


<!-- the html++ bootstrap code here -->
<div class='container position-relative'style='margin-top:4rem '>

<span id='success'></span>

<!-- the messages alret that pops up after submit a form -->



<!-- end of the message alert section-->



<!-- the department tasks section -->
<div class='container'>

<!-- the department tasks -->
<figure class='text-center'>
  <blockquote class='blockquote'>
    <h1>Department Tasks</h1>
  </blockquote>
</figure>


<!-- this is the progress bar -->
<div class='row m-4'>
  <div class='col-sm-auto'>
    <p>Daily Tasks Completion</p>
  </div>


  <div class='col'>
    <div class='progress' role='progressbar' aria-label='Basic example' aria-valuenow='0' aria-valuemin='0' aria-valuemax='100'>
      <div class='progress-bar' style='width:{{graph_presentation.department_task_graph}}%'>{{graph_presentation.department_task_graph}}</div>
    </div>
  </div>

</div><!-- row end div-->



<!-- this is the tasks card section --> 
<div class='row row-cols-1 row-cols-md-4 g-4'>

  {% for department_task in department_tasks %}
    <div class='col'>
      <div class='card m-1'>
        {% if department_task.completed %}
        <div class='card-header'>Completed</div>
        <div class='card-body text-success'>
          <h5 class='card-title'>{{department_task.title}}</h5>
          <p class='card-text'>{{department_task.content}}</p>
        </div><!-- end of card-body-->

          <div class='card-footer text-body-secondary'>
            <div class='col-sm-auto' style='margin-top: 15px'>
              <small class='text-body-secondary m-1' >{{department_task.created_at}}</small>
              <div class='col-sm-auto' style='margin-top: 15px'>


                <button  name='task_on_progress_task' class='btn btn-primary department_task_on_progress_button' member_id='{{department_task.id}}' id='{{department_task.id}}'>On Progress</button>
              {% else %}
              <div class='card-header'>On progress</div>
              <div class='card-body'>
                <h5 class='card-title'>{{department_task.title}}</h5>
                <p class='card-text'>{{department_task.content}}</p>
              </div><!-- end of card-body-->
      
                <div class='card-footer text-body-secondary'>
                  <div class='col-sm-auto' style='margin-top: 15px'>
                    <small class='text-body-secondary m-1' >{{department_task.created_at}}</small>
                    <div class='col-sm-auto' style='margin-top: 15px'>
      
      
                <button  name='complete_task_form' class='btn btn-primary department_task_complete_button' member_id='{{department_task.id}}' id='{{department_task.id}}'>Complete</button>
              {% endif %}
              <button type='submit'  name='task_delete' class='btn btn-danger department_task_delete_button' member_id='{{department_task.id}}' id='{{department_task.id}}'>Delete</button>

              </div>
            </div>
          </div>

      </div>
    </div>
  {% endfor %}

    </div><!-- end of row div-->
  </div><!-- the department tasks section container END DIV-->
</div><!-- end div of class='container position-relative' -->



<!-- the card group html-->

<!-- the TASKS title -->
<div class='container'style='margin-top:4rem ;'>
<figure class='text-center'>
  <blockquote class='blockquote'>
    <h1>Tasks</h1>
  </blockquote>
</figure>


<!-- this is the progress bar -->
<div class='row m-4'>
  <div class='col-sm-auto'>
    <p >Daily Tasks Completion</p>
  </div><!-- col end div-->
  <div class='col'>
    <div class='progress' role='progressbar' aria-label='Basic example' aria-valuenow='0' aria-valuemin='0' aria-valuemax='100'>
      <div class='progress-bar' style='width: {{graph_presentation.employer_task_graph}}%'>{{graph_presentation.employer_task_graph}}%</div>
    </div>
  </div>


<!-- add task modal section below -->

<!-- button 'new task' clicked and then trigger the modal form -->
<div class='col-sm-auto'>
  <button type='button' class='btn btn-success' data-bs-toggle='modal' data-bs-target='#add_task_modal' data-bs-whatever='@getbootstrap'>Create New</button>
    <div class='modal fade' id='add_task_modal' tabindex='-1' aria-labelledby='add_task_modal_label' aria-hidden='true'>
      <div class='modal-dialog'>
        <div class='modal-content'>
          <div class='modal-header'>
            <h1 class='modal-title fs-5' id='add_task_modal_label'>New Task</h1>
            <button type='button' class='btn-close' data-bs-dismiss='modal' aria-label='Close'></button>
          </div>


      <!-- form of adding new task --> 
      <div class='modal-body'>

        <form id='add_task_submit_form' method='POST'>

          {% csrf_token %}

          <!-- body of the form fields-->

          <div class='mb-3'>
            <label for='title' class='col-form-label'>Title</label>
              {% render_field add_task_form.title type='text' id='title' class='form-control'  %}
          </div>

          <div class='mb-3'>
            <label for='content' class='col-form-label'>Description</label>
              {% render_field add_task_form.content type='text' id='content' class='form-control'  %}
          </div>

      </div><!-- end div of the modal-body -->

        <!-- modal footer section -->
        <div class='modal-footer'>
          <button type='button' class='btn btn-secondary' data-bs-dismiss='modal'>Close</button>
          <button type='submit' name='submit_new_task' value='submit_new_task' class='btn btn-primary'>Save</button>
        </div>

      </form>


      </div><!-- end of 'modal-content'-->

      </div><!-- end of 'modal-dialog' -->
    </div><!-- 'modal fade' -->

  </div><!-- end of 'col-sm-auto'-->
</div><!-- end of 'row m-4' -->




<!-- the cards TASKS -->
<div class='container'>

  <div class='row row-cols-1 row-cols-md-4 g-4'>

    {% for task in employer_tasks %}

      <div class='col'>
        <div class='card m-1'>

          {% if task.completed %}

            <div class='card-header text-success'>Completed</div>
            <div class='card-body text-success'>

          {% else %}

            <div class='card-header text-bold'>Unfinished</div>
            <div class='card-body'>

              {% endif %}

              <h5 class='card-title'>{{ task.title }}</h5>
              <p class='card-text'>{{ task.content }}</p>

            </div><!-- end of 'card-body' -->

      <!-- card footer section-->
        <div class='card-footer text-body-secondary'>
          <div class='col-sm-auto' style='margin-top: 15px'>
            <small class='text-body-secondary m-1' >{{ task.created_at }}</small>
              <div class='col-sm-auto' style='margin-top: 15px'>


                  {% csrf_token %}

                    {% if task.completed %}
                      <button  name='task_on_progress_task' class='btn btn-primary task_on_progress_button' member_id='{{task.id}}' id='{{task.id}}'>On Progress</button>
                    {% else %}
                      <button  name='complete_task_form' class='btn btn-primary task_complete_button' member_id='{{task.id}}' id='{{task.id}}'>Complete</button>
                    {% endif %}
                    
                  <button type='submit'  name='task_delete' class='btn btn-danger task_delete_button' member_id='{{task.id}}' id='{{task.id}}'>Delete</button>
                  <a type='button' href="{% url 'edit_task' task.id %}" class='btn btn-secondary task_edit_button' name='task_edit' value='{{task.id}}' >Edit</a>



                <!-- <button type='button' method='POST' name='complete_task_form'  value='{{task.id}}' href='#'  class='btn btn-primary' id='completed'>Complete</button> -->


              </div><!-- end of 'col-sm-auto' -->


            </div><!-- end of 'col-sm-auto' -->

          </div><!-- end of 'card-footer text-body-secondary' -->
          
        </div><!-- end of 'card-body text-success' -->

      </div><!-- end of 'card m-1' -->

    {% endfor %}

    </div><!-- end of 'col' -->

  </div><!-- end of 'row row-cols-1 row-cols-md-4 g-4' -->

</div><!-- end of 'container' -->

</div><!-- end of 'container'style='margin-top:4rem ;' on line 94 -->


<!-- the title of the tasks -->
<div class='container text-end'style='margin-top:4rem ;'>
<figure class='text-center'>
  <blockquote class='blockquote'>
    <h1>Leads</h1>
  </blockquote>
</figure>


<!-- the add lead modal section-->
<div class='row m-4'>
  <div class='col'>

    <button type='button' class='btn btn-success' data-bs-toggle='modal' data-bs-target='#add_lead_modal' data-bs-whatever='@getbootstrap'>Create New</button>
      <div class='modal fade' id='add_lead_modal' tabindex='-1' aria-labelledby='add_lead_modal_label' aria-hidden='true'>
        <div class='modal-dialog'>
          
          <div class='modal-content'>
            <div class='modal-header'>
              <h1 class='modal-title fs-5' id='add_lead_modal_label'>New Lead</h1>
              <button type='button' class='btn-close' data-bs-dismiss='modal' aria-label='Close'></button>
            </div>
            <div class='modal-body text-start'>
    
            <!-- form of adding new lead -->
              <form method='POST'>
                {% csrf_token %}
    
                <!-- lead form input fields -->
                <div class='mb-3'>
                  <label for='name' class='col-form-label'>Name</label>
                  {% render_field add_lead_form.name type='text' id='name' class='form-control'  %}
                </div>

                <div class='mb-3'>
                  <label for='description' class='col-form-label'>Description</label>
                  {% render_field add_lead_form.description type='text' id='description' class='form-control'  %}
                </div>

              </div><!-- end of 'modal-body' -->

                <div class='modal-footer'>
                  <button type='button' class='btn btn-secondary' data-bs-dismiss='modal'>Close</button>
                  <button type='submit' name='submit_new_lead' value='submit_new_lead' class='btn btn-primary'>Save</button>
                </div>

              </form>

          </div><!-- end of 'modal-content' -->

        </div><!-- end of 'modal-dialog' -->

      </div><!-- end of 'modal fade' -->



  </div><!-- end of 'col' -->
</div><!-- end of 'row' -->
</div><!-- end of 'container text-end' -->



 <!-- the container end div-->
 <div class='container'>
    <div class='row row-cols-1 row-cols-md-4 g-4'>
    {% for lead in leads %}
      <div class='col'>

        <div class='card m-1'>

          {% if lead.completed %}
            <div class='card-header text-success '>COMPLETED</div>
            <div class='card-body text-success'>
          {% else %}
            <div class='card-header'>On Progress</div>
            <div class='card-body'>
          {% endif %}

              <h5 class='card-title'>{{lead.name}}</h5>
              <p class='card-text'>{{lead.description}}</p>
            
            </div><!-- end of 'card-body' -->

          <div class='card-footer text-body-secondary'>
            
            <div class='col-sm-auto' style='margin-top: 15px'>
              <small class='text-body-secondary m-1' >{{lead.created_at}}</small>
              <div class='col-sm-auto' style='margin-top: 15px'>
                

                  {% csrf_token %}

                  {% if lead.completed %}
                    <button type='submit' name='lead_on_progress'  class='btn btn-primary lead_on_progress_button' member_id='{{lead.id}}'>On Progress</button>
                    <a type='button' href="{% url 'edit_lead' lead.id %}" class='btn btn-secondary' name='lead_edit' value='{{lead.id}}' >Edit</a>
                  {% else %}
                    <button name='lead_complete' value='{{lead.id}}' member_id='{{lead.id}}' class='btn btn-primary lead_complete_button'>Complete</button>
                    <a type='button' href="{% url 'edit_lead' lead.id %}" class='btn btn-secondary' name='lead_edit' value='{{lead.id}}' >Edit</a>
                  {% endif %}
                



              </div><!-- end of 'col-sm-auto' -->

            </div><!-- 'col-sm-auto' -->

          </div><!-- 'card-footer text-body-secondary' -->
          
        </div><!-- end of 'card-body' -->

      </div><!-- end of 'card m-1' -->

    {% endfor %}

  </div><!-- end of 'col' -->

</div><!-- end of row-->

</div><!-- end of 'container' -->

<!-- script section that uses ajax on forms -->
<script>
  $('.department_task_complete_button').on('click',department_task_complete_ajax)
</script>
<script>
  $('.department_task_on_progress_button').on('click',department_task_on_progress_ajax)
</script>
<script>
  $('.department_task_delete_button').on('click',department_task_delete_ajax)
</script>
<script>
  $(document).on('submit','#add_task_submit_form',add_task_ajax)
</script>
<script>
  $('.task_complete_button').on('click',complete_task_ajax)
</script>
<script>
  $('.task_on_progress_button').on('click',on_progress_task_ajax)
</script>
<script>
  $('.task_delete_button').on('click',task_delete_ajax)
</script>
<script>
  $('.lead_complete_button').on('click',lead_complete_ajax)
</script>
<script>
  $('.lead_on_progress_button').on('click',lead_on_progress_ajax)
</script>
</div>
{% endblock content%}
